import { useEffect, useRef, useState } from 'react';

import { Canvas, Meta, Story, ArgsTable } from '@storybook/addon-docs';

import { useRive, useStateMachineInput } from '../../src';
import { Button } from './components/Button';
import './rive-overview.css';

<Meta title="React opuijpoijkpojkp/Playback Controls" />

# Animation Playback

When rendering Rives, you may want to control animation playback for certain scenarios. Animation playback allows you to programatically pause, stop, play, reset, and scrub animations as needed. You may find this useful for coordinating certain user interaction or other programatic cases to Rive animations.

**Note:** Just like the Rive web runtime, you invoke playback methods on a `rive` instance. Because of this, you will need to use the `useRive` method to render Rives to your React applications, as it returns a `rive` instance for you to invoke controls on.

## User event-driven playback

You can control Rive animation playback with user interaction directly on the canvas, or even outside the canvas, as you'll see below.

### Play/pause with hover

The example below shows how to start with a Rive instance that does not autoplay initially, but plays whenever the cursor is hovered over the canvas, and returns to a paused state when the mouse leaves the canvas.

<Canvas withSource="open">
  <Story name="Play/pause with hover">
    {() => {
      const ref = useRef(null);
      const { rive, RiveComponent } = useRive({
        src: 'poision-loader.riv',
        autoplay: false,
        animations: 'Hover',
      });
      useEffect(() => {
        const observer = new IntersectionObserver(
          ([things]) => {
            if (rive) {
              if (things.isIntersecting) {
                rive.play('Hover');
              } else {
                rive.pause('Hover');
              }
            }
          },
          {
            rootMargin: '0px',
            threshold: 0.1,
          }
        );
        if (ref && ref.current) {
          observer.observe(ref.current);
        }
      }, [rive]);
      return (
        <div ref={ref} className="center">
          <RiveComponent className="base-canvas-size" />
        </div>
      );
    }}
  </Story>
</Canvas>
